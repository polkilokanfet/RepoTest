<inf:ViewBase
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:inf="clr-namespace:HVTApp.Infrastructure;assembly=HVTApp.Infrastructure"
             xmlns:ig="http://infragistics.com/DataPresenter"
             x:Class="HVTApp.Modules.Sales.Views.MarketView"
             prism:ViewModelLocator.AutoWireViewModel="True"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity">

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding LoadedCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="2*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
            
        <GroupBox Grid.Row="0" Header="Проекты" >
            <ScrollViewer>
                <ig:XamDataGrid DataSource="{Binding Projects}"
                                  SelectedDataItem="{Binding SelectedProject, Mode=TwoWay}">

                    <ig:XamDataGrid.FieldLayouts>
                        <ig:FieldLayout Key="Project">
                            <ig:FieldLayout.Fields>
                                <ig:TextField Name="Name" Label="Проект"/>
                                <ig:TextField Name="Facilities" Label="Объекты" Converter="{StaticResource WrappersToStringConverter}"/>
                                <ig:NumericField Name="Sum" Label="Сумма"/>

                                <ig:Field Name="ProjectUnits" Converter="{StaticResource ProductUnitsToProductGroupsConverter}" IsExpandable="True" IsPrimary="True"/>
                            </ig:FieldLayout.Fields>
                        </ig:FieldLayout>

                        <ig:FieldLayout Key="ProjectUnit" ParentFieldLayoutKey="Project" ParentFieldName="ProjectUnits">
                            <ig:FieldLayout.Fields>
                                <ig:TextField Name="Facility" Label="Объект" Converter="{StaticResource WrapperToStringConverter}"/>
                                <ig:TextField Name="Product" Label="Оборудование" Converter="{StaticResource WrapperToStringConverter}"/>
                                <ig:NumericField Name="Amount" Label="Количество"/>
                                <ig:NumericField Name="Cost" Label="Стоимость"/>
                                <ig:NumericField Name="Total" Label="Сумма"/>
                            </ig:FieldLayout.Fields>
                        </ig:FieldLayout>

                    </ig:XamDataGrid.FieldLayouts>

                </ig:XamDataGrid>
            </ScrollViewer>
        </GroupBox>
        
        <GridSplitter Grid.Row="1" Height="2" Grid.ColumnSpan="1" HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
        
        <GroupBox Grid.Row="2" Header="Конкурсы">
            <ScrollViewer>
                <ig:XamDataGrid DataSource="{Binding SelectedProject.Tenders}">
                    <ig:XamDataGrid.FieldLayouts>
                        <ig:FieldLayout Key="Tender">
                            <ig:FieldLayout.Fields>
                                <ig:TextField Name="Type" Label="Тип" Converter="{StaticResource WrapperToStringConverter}"/>
                                <ig:NumericField Name="Sum" Label="Сумма"/>
                                <ig:TextField Name="Winner" Label="Победитель" Converter="{StaticResource WrapperToStringConverter}"/>

                                <ig:Field Name="TenderUnits" Converter="{StaticResource ProductUnitsToProductGroupsConverter}" IsExpandable="True" IsPrimary="True"/>
                            </ig:FieldLayout.Fields>
                        </ig:FieldLayout>

                        <ig:FieldLayout Key="TenderUnit" ParentFieldLayoutKey="Tender" ParentFieldName="TenderUnits">
                            <ig:FieldLayout.Fields>
                                <ig:TextField Name="Facility" Label="Объект" Converter="{StaticResource WrapperToStringConverter}"/>
                                <ig:TextField Name="Product" Label="Оборудование" Converter="{StaticResource WrapperToStringConverter}"/>
                                <ig:NumericField Name="Amount" Label="Количество"/>
                                <ig:NumericField Name="Cost" Label="Стоимость"/>
                                <ig:NumericField Name="Total" Label="Сумма"/>
                            </ig:FieldLayout.Fields>
                        </ig:FieldLayout>

                    </ig:XamDataGrid.FieldLayouts>
                </ig:XamDataGrid>
            </ScrollViewer>
        </GroupBox>

        <GridSplitter Grid.Row="3" Height="2" Grid.ColumnSpan="1" HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
        
        <GroupBox Grid.Row="4" Header="Предложения">
            <ScrollViewer>
                <ig:XamDataGrid DataSource="{Binding SelectedProject.Offers}"
                                SelectedDataItem="{Binding SelectedOffer}">
                    <ig:XamDataGrid.FieldLayouts>
                        <ig:FieldLayout Key="Offer">
                            <ig:FieldLayout.Fields>
                                <ig:TextField Label="Компания" AlternateBinding="{Binding RecipientEmployee.Company}" BindingType="UseAlternateBinding" Converter="{StaticResource WrapperToStringConverter}"/>
                                <ig:CurrencyField Label="Сумма" Name="TotalCost"/>

                                <ig:Field Name="OfferUnits" Converter="{StaticResource ProductUnitsToProductGroupsConverter}" IsExpandable="True" IsPrimary="True"/>
                            </ig:FieldLayout.Fields>
                        </ig:FieldLayout>

                        <ig:FieldLayout Key="OfferUnit" ParentFieldLayoutKey="Offer" ParentFieldName="OfferUnits">
                            <ig:FieldLayout.Fields>
                                <ig:TextField Name="Facility" Label="Объект" Converter="{StaticResource WrapperToStringConverter}"/>
                                <ig:TextField Name="Product" Label="Оборудование" Converter="{StaticResource WrapperToStringConverter}"/>
                                <ig:NumericField Name="Amount" Label="Количество"/>
                                <ig:NumericField Name="Cost" Label="Стоимость"/>
                                <ig:NumericField Name="Total" Label="Сумма"/>
                            </ig:FieldLayout.Fields>
                        </ig:FieldLayout>

                    </ig:XamDataGrid.FieldLayouts>
                </ig:XamDataGrid>
            </ScrollViewer>
        </GroupBox>

    </Grid>

</inf:ViewBase>